<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Admin - GJPB Stats</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <h1>Ajouter un match</h1>

    <input type="date" id="date">
    <input type="text" id="equipe" placeholder="Équipe">
    <input type="text" id="adversaire" placeholder="Adversaire">
    <input type="number" id="buts_gjpb" placeholder="Buts GJPB">
    <input type="number" id="buts_adv" placeholder="Buts Adversaire">

    <label>Buteurs :</label>
    <div id="buteurs-container"></div>

    <label>Passeurs :</label>
    <div id="passeurs-container"></div>

    <button onclick="soumettreMatch()">Enregistrer</button>

    <script>
        const supabase = window.supabase.createClient(
            'https://lgnwgbctaqaeawzjnuqh.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxnbndnYmN0YXFhZWF3empudXFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4MjYzNjUsImV4cCI6MjA2OTQwMjM2NX0.E0ug5jpRQVh55aq1ewToqol7h7aRPkg7YvwbKpQtVHo'
        );

        let joueurs = [];

        document.addEventListener('DOMContentLoaded', async () => {
            const { data, error } = await supabase.from('joueurs').select('*');
            if (error) return console.error('Erreur chargement joueurs :', error);
            joueurs = data.map(j => j.nom);

            // Créer 3 selects pour buteurs et passeurs (test simple)
            for (let i = 0; i < 3; i++) {
                ajouterSelect('buteurs-container', `buteur_${i}`);
                ajouterSelect('passeurs-container', `passeur_${i}`);
            }
        });

        function ajouterSelect(containerId, selectId) {
            const select = document.createElement('select');
            select.id = selectId;
            joueurs.forEach(nom => {
                const opt = document.createElement('option');
                opt.value = nom;
                opt.textContent = nom;
                select.appendChild(opt);
            });
            document.getElementById(containerId).appendChild(select);
        }

        async function soumettreMatch() {
            const date = document.getElementById('date').value;
            const equipe = document.getElementById('equipe').value;
            const adversaire = document.getElementById('adversaire').value;
            const buts_gjpb = parseInt(document.getElementById('buts_gjpb').value) || 0;
            const buts_adv = parseInt(document.getElementById('buts_adv').value) || 0;

            const { data: match, error } = await supabase.from('matchs').insert([{ date, equipe, adversaire, buts_gjpb, buts_adv }]).select().single();
            if (error) return console.error('Erreur ajout match :', error);

            const id = match.id;
            const actions = [];

            document.querySelectorAll('#buteurs-container select').forEach(s => actions.push({ match_id: id, joueur: s.value, type: 'Goal' }));
            document.querySelectorAll('#passeurs-container select').forEach(s => actions.push({ match_id: id, joueur: s.value, type: 'Assist' }));

            const { error: actErr } = await supabase.from('actions').insert(actions);
            if (actErr) return console.error('Erreur ajout actions :', actErr);

            alert("Match + actions enregistrés !");
        }
    </script>
</body>

</html>