<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Debug Supabase â€” joueurs</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: system-ui, Arial;
            margin: 24px;
            max-width: 800px
        }

        code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 6px
        }

        .ok {
            color: #0a7d25
        }

        .warn {
            color: #b36b00
        }

        .err {
            color: #b00020
        }

        pre {
            background: #f6f8fa;
            padding: 12px;
            border-radius: 8px;
            overflow: auto
        }
    </style>
</head>

<body>
    <h1>Debug Supabase â€” lecture de <code>joueurs</code></h1>

    <div id="cfg"></div>
    <hr />
    <h2>RÃ©sultats</h2>
    <p id="rest"></p>
    <p id="sdk"></p>
    <details>
        <summary>JSON REST (premiers items)</summary>
        <pre id="restJson"></pre>
    </details>
    <details>
        <summary>JSON SDK (premiers items)</summary>
        <pre id="sdkJson"></pre>
    </details>

    <script>
        // ðŸ”§ REMPLACE ICI par les valeurs de Project Settings > API
        const SUPABASE_URL = 'https://lgnwgbctaqaeawzjnuqh.supabase.co';
        const SUPABASE_ANON_KEY = 'PASTE_YOUR_PUBLIC_ANON_KEY_HERE';

        // Affiche la config utilisÃ©e (clÃ© tronquÃ©e)
        document.getElementById('cfg').innerHTML =
            `<b>URL utilisÃ©e :</b> <code>${SUPABASE_URL}</code><br>` +
            `<b>anon key :</b> <code>${SUPABASE_ANON_KEY.slice(0, 12)}â€¦</code>`;

        // 1) Test API REST directe (bypasse supabase-js)
        async function testREST() {
            const url = `${SUPABASE_URL}/rest/v1/joueurs?select=nom&order=nom`;
            try {
                const r = await fetch(url, {
                    headers: {
                        apikey: SUPABASE_ANON_KEY,
                        Authorization: 'Bearer ' + SUPABASE_ANON_KEY
                    }
                });
                const j = await r.json();
                document.getElementById('rest').innerHTML =
                    r.ok
                        ? `<span class="ok">REST OK</span> â€” ${Array.isArray(j) ? j.length : 0} joueur(s)`
                        : `<span class="err">REST ${r.status}</span>`;
                document.getElementById('restJson').textContent = JSON.stringify(j?.slice?.(0, 10) ?? j, null, 2);
                return { ok: r.ok, data: j, status: r.status };
            } catch (e) {
                document.getElementById('rest').innerHTML = `<span class="err">REST erreur</span> â€” ${e}`;
                return { ok: false, error: e };
            }
        }

        // 2) Test via supabase-js
        async function testSDK() {
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            const { data, error } = await supabase.from('joueurs').select('nom').order('nom');
            if (error) {
                document.getElementById('sdk').innerHTML = `<span class="err">SDK erreur</span> â€” ${error.message}`;
            } else {
                document.getElementById('sdk').innerHTML = `<span class="ok">SDK OK</span> â€” ${data.length} joueur(s)`;
                document.getElementById('sdkJson').textContent = JSON.stringify(data.slice(0, 10), null, 2);
            }
            return { data, error };
        }

        (async () => {
            const rest = await testREST();
            const sdk = await testSDK();

            // Aide rapide selon les cas
            if (rest.ok && Array.isArray(rest.data) && rest.data.length === 0) {
                console.warn('REST renvoie [], donc ce projet renvoie vide â†’ vÃ©rifier RLS/GRANT/URL/clÃ©.');
            }
            if (!rest.ok && rest.status === 401) {
                console.warn('401 â†’ vÃ©rifie apikey/Authorization (anon key).');
            }
            if (!rest.ok && rest.status === 404) {
                console.warn('404 â†’ mauvais chemin (table), mais ici il est correct si la table existe bien.');
            }
        })();
    </script>
</body>

</html>